# Remaining Roadmap (2026-02-27)

## Goal
HLKX との互換を「実運用での一致」から「ロジック網羅での一致」へ引き上げる。

## Priority Roadmap

## 1) 命令実行系の最終監査（最優先）
- [x] `make_exe.s` の `Opaque / expression / stack write` を分岐単位で棚卸し
- [x] 未カバー分岐に対応する unit/compat テストを先行追加
- [x] 実装を埋め、回帰ハーネスで固定化
- 完了条件: 分岐対応表（asm ↔ Rust test）が埋まり、既知未対応が明示ゼロ

## 2) SCD 補正ロジックの厳密化
- [x] `reduced fixup` の差分を `make_scdinfo` と比較して列挙
- [x] 未実装分岐の補正ロジックを追加
- [x] SCD 専用ケースで raw 出力比較を追加
- 完了条件: SCD 関連で「最小実装」注記を解消

## 3) 入力解決（obj/arc/lib）互換の厳密化
- [x] archive member 抽出優先順位の HLK 差分を整理
- [x] 探索順・再訪順依存ケースを追加
- [x] 同名定義競合時の優先規則を HLK 挙動に固定
- 完了条件: `object.s` 相当の探索順依存ケースが一致

## 4) CLI 未移植オプション
- [x] `-i/-l/-L/-0/-1` の仕様確認（必要なら no-op ではなく明示実装）
- [x] オプションごとに parser + 挙動 + tests を追加
- [x] 監査ドキュメントの未移植一覧を縮小
- 完了条件: 主要オプション差分が解消、または意図的非対応として明記

## 5) map 最終一致化
- [x] raw map 比較（パス差分のみ正規化）を回帰ハーネスへ導入
- [ ] 必要に応じて map ヘッダのパス扱いポリシーを最終確定
- 完了条件: map 比較方針がドキュメント化され、CI 相当で安定

## 6) 最終総合検証
- [ ] HAS + 原版 HLK + Rhlk の end-to-end 再検証
- [ ] 生成物差分の最終監査（`.x/.r/.mcs/.map`, messages, rc）
- [ ] 既知差分一覧を最終版として更新
- 完了条件: リリース判断可能な最終監査レポート完成

## Execution Order
1. 命令実行系
2. SCD 厳密化
3. 入力解決厳密化
4. CLI 未移植
5. 最終総合検証

## Notes
- 直近で `-s`, `-d`, `-g` と map 形式寄せ、map raw 比較強化までは完了済み。
- 以後は「テスト先行で未カバー分岐を潰す」を継続方針とする。
