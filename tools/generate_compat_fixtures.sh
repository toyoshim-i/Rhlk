#!/usr/bin/env bash
set -euo pipefail

ROOT_DIR="$(cd "$(dirname "$0")/.." && pwd)"
OUT_DIR="${ROOT_DIR}/tests/compat/fixtures"
mkdir -p "${OUT_DIR}"

# d32_adrs_main.o
# Hand-crafted valid object stream to trigger:
# "32ビットディスプレースメントにアドレス属性シンボルの値を出力"
xxd -r -p > "${OUT_DIR}/d32_adrs_main.o" <<'HEX'
d000000000626433325f6d61696e0000c00100000004746578740000c00200000000646174610000c0030000000062737300c00400000000737461636b00b2ff000000016162735f73796d006a010000000000010000000000000000000000000000
HEX

# d32_adrs_abs.o
# Valid object that defines abs_sym as absolute.
xxd -r -p > "${OUT_DIR}/d32_adrs_abs.o" <<'HEX'
d0000000004c6433325f61627300c00100000000746578740000c00200000000646174610000c0030000000062737300c00400000000737461636b00b200000000006162735f73796d000000
HEX

# stack_under.o
# Valid object stream that executes wrt_stk_9000 without push and triggers:
# "計算用スタックに値がありません"
xxd -r -p > "${OUT_DIR}/stack_under.o" <<'HEX'
d0000000004568737461636b5f756e6465720000c00100000002746578740000c00200000000646174610000c0030000000062737300c00400000000737461636b0090000000
HEX

# stack_under_9200.o
# wrt_stk_9200 without push.
xxd -r -p > "${OUT_DIR}/stack_under_9200.o" <<'HEX'
d0000000004568737461636b5f756e6465720000c00100000002746578740000c00200000000646174610000c0030000000062737300c00400000000737461636b0092000000
HEX

# stack_under_9600.o
# wrt_stk_9600 without push.
xxd -r -p > "${OUT_DIR}/stack_under_9600.o" <<'HEX'
d0000000004568737461636b5f756e6465720000c00100000002746578740000c00200000000646174610000c0030000000062737300c00400000000737461636b0096000000
HEX

# stack_under_9a00.o
# wrt_stk_9a00 without push.
xxd -r -p > "${OUT_DIR}/stack_under_9a00.o" <<'HEX'
d0000000004568737461636b5f756e6465720000c00100000002746578740000c00200000000646174610000c0030000000062737300c00400000000737461636b009a000000
HEX

# stack_over.o
# HLK's calc stack size is 1024 entries, one entry per 0x8000 push.
# Emit 1025 pushes to trigger "stack over".
xxd -r -p > "${OUT_DIR}/stack_over.o" <<'HEX'
d0000000004568737461636b5f756e6465720000c00100000002746578740000c00200000000646174610000c0030000000062737300c00400000000737461636b00
HEX
for _ in $(seq 1 1025); do
  printf '\x80\x00\x00\x00\x00\x00' >> "${OUT_DIR}/stack_over.o"
done
printf '\x00\x00' >> "${OUT_DIR}/stack_over.o"

echo "generated fixtures in ${OUT_DIR}"
